# 米家BLE Object定义

## 简介

本文档定义了米家mibeacon使用场景中的Object ID以及Object格式。

## 格式定义

|      字段       | 长度 |    描述    |
| :-------------: | :--: | :--------: |
|    Object ID    |  2   | 米家定义ID |
| Object Data Len |  1   |  Data长度  |
|   Object Data   |  N   |    数据    |

## ID定义

由米家定义，分配如下：

- 0x0000 - 0x1001 为蓝牙通用事件
- 0x1002 - 0x1FFF 为蓝牙通用属性
- 0x2000 - 0x2FFF 为厂商自定义属性，由相应厂商向小米申请
- 0x3000 - 0x3FFF 为厂商自定义事件，由相应厂商向小米申请

为保证数据及时、有效，并且未给米家服务器造成较大负载压力，米家BLE网关会依据ID对不同类型数据做过滤，当数据与之前上报数据相比有变化且相隔一定时间，BLE网关才会转发该数据至米家服务器。

### 通用事件

|   名称   |   ID   | 时间间隔（秒） | 变化量 |
| :------: | :----: | :------------: | :----: |
|   连接   | 0x0001 |       0        |   0    |
| 简易配对 | 0x0002 |       0        |   0    |
|   靠近   | 0x0003 |       0        |   0    |
|   远离   | 0x0004 |       0        |   0    |
|    锁    | 0x0005 |       0        |   0    |
|   指纹   | 0x0006 |       0        |   0    |
|    门    | 0x0007 |       0        |   0    |
|   布防   | 0x0008 |       0        |   0    |
|   按键   | 0x1001 |       0        |   0    |

### 通用属性

|   名称   |   ID   | 时间间隔（秒） | 变化量 |
| :------: | :----: | :------------: | :----: |
|   睡眠   | 0x1002 |      600       |   0    |
|   RSSI   | 0x1003 |       0        |   10   |
|   温度   | 0x1004 |      600       |   1    |
|   煮水   | 0x1005 |       60       |   0    |
|   湿度   | 0x1006 |      600       |   1    |
|   亮度   | 0x1007 |      600       |   1    |
| 土壤湿度 | 0x1008 |      600       |   1    |
| 土壤EC值 | 0x1009 |      600       |   1    |
|   电量   | 0x100A |      600       |   0    |
|    锁    | 0x100E |       60       |   0    |
|    门    | 0x100F |       0        |   0    |
|   甲醛   | 0x1010 |      600       |   1    |
|   绑定   | 0x1011 |      600       |   0    |

### 厂商自定义属性

|       名称       |   ID   | 时间间隔（秒） | 变化量 |
| :--------------: | :----: | :------------: | :----: |
|  体温（秒秒测）  | 0x2000 |      600       |   0    |
| 手环属性（华米） | 0x2001 |       0        |   1    |
|  吸尘器（睿米）  | 0x2002 |      600       |   0    |

### 厂商自定义事件

|        名称        |   ID   | 时间间隔（秒） | 变化量 |
| :----------------: | :----: | :------------: | :----: |
| 监测仪（花花草草） | 0x3000 |      600       |   1    |
| 传感器位置（青萍） | 0x3001 |      600       |   0    |

## 事件格式定义

### 简易配对事件

|   名称    | 长度 |                  描述                   |
| :-------: | :--: | :-------------------------------------: |
| Object ID |  2   | 待配对Object ID，例如按键事件（0x1001） |

### 锁事件

|   名称   | 长度 |    描述    |
| :------: | :--: | :--------: |
| 当前操作 |  1   |   见下文   |
| 操作方式 |  1   |   见下文   |
|  Key ID  |  4   |   见下文   |
|  时间戳  |  4   | 操作时间戳 |

当前操作分为以下几类：

- 0x00：开锁
- 0x01：上锁
- 0x02：反锁
- 0xFF：异常

操作方式分为以下几类：

- 0x00：蓝牙
- 0x01：密码
- 0x02：指纹
- 0x03：钥匙
- 0x04：转盘
- 0x05：NFC
- 0x10：人工反锁
- 0x11：人工上锁
- 0x20：自动反锁
- 0xFF：异常

Key ID分为以下几类：

- 0x00000000：锁的管理员
- 0xFFFFFFFF：未知操作者
- 0xC0DE0000：操作次数超限（错误密码频繁开锁）
- 0xC0DE0001：操作次数超限（错误指纹频繁开锁）
- 0xC0DE0002：操作超时（密码输入超时）
- 0xC0DE0003：撬锁
- 0xC0DE0004：重置按键按下
- 0xC0DE1000：电量低于10%
- 0xC0DE1001：电量低于5%
- 0xC0DE1002：指纹传感器异常

### 指纹事件

|   名称   | 长度 |  描述  |
| :------: | :--: | :----: |
|  Key ID  |  4   | 见上文 |
| 匹配结果 |  1   | 见下文 |

匹配结果分为以下几类：

- 0x00：匹配成功
- 0x01：匹配失败
- 0x02：超时未放入
- 0x03：质量低（太浅、模糊）
- 0x04：面积不足
- 0x05：皮肤太干
- 0x06：皮肤太湿

### 门事件

| 名称 | 长度 |                   描述                   |
| :--: | :--: | :--------------------------------------: |
| 状态 |  1   | 开门（0x00）、关门（0x01）、异常（0xFF） |

### 布防事件

|   名称   | 长度 |            描述            |
| :------: | :--: | :------------------------: |
| 是否启用 |  1   | 开启（0x01）、关闭（0x00） |

### 按键事件

| 名称 | 长度 |                   描述                   |
| :--: | :--: | :--------------------------------------: |
|  ID  |  2   |                 按键键值                 |
| 类型 |  1   | 单击（0x00）、双击（0x01）、长按（0x02） |

### 花花草草检测仪事件

| 名称 | 长度 |            描述            |
| :--: | :--: | :------------------------: |
| 状态 |  1   | 正常（0x00）、拔出（0x01） |

### 青萍传感器事件

| 名称 | 长度 |               描述               |
| :--: | :--: | :------------------------------: |
| 位置 |  1   | 与底座分离（0x00）、连接（0x01） |

## 属性格式定义

### 睡眠属性

| 名称 | 长度 |             描述             |
| :--: | :--: | :--------------------------: |
| 状态 |  1   | 无睡眠（0x00）、睡着（0x01） |

### RSSI属性

| 名称 | 长度 |    描述    |
| :--: | :--: | :--------: |
| RSSI |  1   | 信号强度值 |

### 温度属性

| 名称 | 长度 |                    描述                    |
| :--: | :--: | :----------------------------------------: |
| 温度 |  2   | 单位0.1度，示例：1A 01 = 0x011A 表示28.2度 |

### 煮水属性

| 名称 | 长度 |         描述         |
| :--: | :--: | :------------------: |
| 状态 |  1   |        见下文        |
| 温度 |  1   | 有符号整型，-128~127 |

煮水状态分为以下几类：

- 0x00：待机
- 0x01：加热
- 0x02：煮沸，然后保温到设定温度
- 0x03：加热到设定温度后保温
- 0x04： 异常

### 湿度属性



| 名称 | 长度 |                     描述                     |
| :--: | :--: | :------------------------------------------: |
| 湿度 |  2   | 湿度百分比，取值0-1000，例如346表示湿度34.6% |

### 亮度属性

|  名称  | 长度 |      描述      |
| :----: | :--: | :------------: |
| 流明值 |  3   | 范围：0-120000 |

### 土壤湿度属性

| 名称 | 长度 |          描述           |
| :--: | :--: | :---------------------: |
| 湿度 |  1   | 湿度百分比，范围：0-100 |

### 土壤EC属性

| 名称 | 长度 |          描述           |
| :--: | :--: | :---------------------: |
| EC值 |  2   | 单位us/cm，范围：0-5000 |

### 电量属性

|    名称    | 长度 |    描述     |
| :--------: | :--: | :---------: |
| 电量百分比 |  1   | 范围：0-100 |

### 锁属性

| 名称 | 长度 |  描述  |
| :--: | :--: | :----: |
| 状态 |  1   | 见下文 |

bit 0：方舌状态（1：弹出；0：收回 ）

bit 1：呆舌状态（1：弹出；0：收回）

bit 2：斜舌状态（1：弹出；0：收回）

bit 3：童锁状态（1：开启；0：关闭）

### 门属性

| 名称 | 长度 |                   描述                   |
| :--: | :--: | :--------------------------------------: |
| 状态 |  1   | 开门（0x00）、关门（0x01）、异常（0xFF） |

### 甲醛属性

|  名称  | 长度 |                       描述                        |
| :----: | :--: | :-----------------------------------------------: |
| 甲醛值 |  2   | 精度0.01mg/m3，示例：10 00 = 0x0010 表示0.16mg/m3 |

### 绑定属性

| 名称 | 长度 |              描述              |
| :--: | :--: | :----------------------------: |
| 状态 |  1   | 未绑定（0x00）、已绑定（0x01） |

### 秒秒测体温属性

|   名称   | 长度 |     描述      |
| :------: | :--: | :-----------: |
| 皮肤温度 |  2   | 精确到 0.01度 |
| PCB温度  |  2   | 精确到 0.01度 |
|   电量   |  1   |  电量百分比   |

### 华米手环属性

| 名称 | 长度 |            描述            |
| :--: | :--: | :------------------------: |
| 步数 |  2   |          当前步数          |
| 睡眠 |  1   | 入睡（0x01）、醒来（0x02） |
| RSSI |  1   |     当前信号强度绝对值     |

### 睿米吸尘器属性

| 名称 | 长度 |                             描述                             |
| :--: | :--: | :----------------------------------------------------------: |
| 模式 |  1   | 充电（0x00）、待机（0x01）、标准（0x02）、强劲（0x03）、异常（0xFF） |
| 档位 |  1   |                         当前标准档位                         |

