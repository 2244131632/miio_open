# 小米蓝牙产品设计规约
---

## 产品Model说明
- 产品model为三段式的字符串，最大长度23. 
- 示例：xiaomi.bledemo.v1 
- 说明：厂商名.产品类别.产品型号
- [详细说明](https://open.home.mi.com/resource.html#/summarize)

## 产品ID
- 产品ID为产品类别的唯一标识符，2个字节，与产品model一一对应。
- 该ID在新产品申请的时候分配。
- 该ID必须放在mi beacon广播报文中，智能家庭APP才能正确产品类别。
- 示例：小米蓝牙开发板：0x009C

## 绑定方式说明
- 前绑定：智能家庭扫描到设备，当用户点击设备后，出现设备配图。用户通过图中的提示操作设备，APP此时自动与此设备建立连接。
- RSSI绑定：根据RSSI信号强度最大去进行绑定
- 用户手动选择设备：智能家庭显示周边所有扫到的设备列表，由用户手动点击设备进行绑定

## 设备关系说明
小米智能家庭将蓝牙设备与用户账户之间的关系分为强关系与弱关系。
- 强关系设备：设备与用户账号强相关的设备，且产品的价值高
	- 设备初次绑定时，必须去云端同步，成功后才能继续使用。
	- 设备原主人必须显式的解除绑定，新用户才能使用此设备。
	- 例：旅行箱，未授权人员拿到后不能使用
- 弱关系设备：设备与用户账号相关性不是很强，拿到设备即能使用的，如床头灯
	- 设备通过蓝牙连接成功即能使用，云端同步失败不影响正常使用。
	- 设备无须被解绑，另一个用户也能重新跟此设备绑定，即谁拿到了设备就可以使用。

## 自定义Service 规范
蓝牙产品是由多个Service/ Profile组合而成，除了Mi Service，产品必定还会包含自定义的Service, 对于自定义Service的使用，有如下规范需要遵循：
- 尽量不要使用自定义模拟成串口流的方式。
- Serivce中的Characteristic尽量保持单一的含义。
- 如含有敏感数据，隐私数据，隐私控制等数据，请使用Mijia BLE SDK中提供的加密接口。
- ***注***：良好的service格式定义，有助于产品与小米智能家庭中的其他设备进行联动。
- ***注***：开放平台的产品管理中，提供给了Service自动生成向导

## 设备发现与绑定流程
详细参见：[智能家庭蓝牙规范第二章](https://github.com/MiEcosystem/NewXmPluginSDK/blob/master/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%BA%AD%E8%93%9D%E7%89%99%E8%A7%84%E8%8C%83.md)
